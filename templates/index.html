<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FOOD SENSEI </title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/logo.png') }}">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div id="loader-wrapper">
        <div class="loader-content">
            <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" class="loader-logo">
            <p class="loading-text">Loading FOOD SENSEI...</p>
            <div class="glow-ring">
                <span class="loader-text" id="loader-text">0%</span>
              </div>
        </div>
    </div>
    
    <div class="wrapper">
        <nav class="navbar">
            <div class="navbar-container">
                <a href="/" class="logo">
                    <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Food Sensei Logo" class="logo-img">
                </a>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="/about">About</a></li>
                </ul>
            </div>
        </nav>
        
        <div class="container">
            <header>
                <h1>FOOD SENSEI</h1>
                <p class="subtitle">Your AI-powered Nutrition & Food Guide</p>
            </header>

            <main>
                <div class="task-buttons">
                    <a href="/task1" class="task-btn">üì∑ Analyze Food</a>
                    <a href="/task2" class="task-btn">üìç Find Healthy Nearby</a>
                    <a href="/task3" class="task-btn">üß† Bust Food Myths</a>
                </div>
            </main>
        </div>
        <div id="camera-section" style="display: none; text-align: center; margin-top: 20px;">
            <video id="camera" autoplay playsinline width="300" height="225" style="border-radius: 10px; border: 2px solid #ccc;"></video>
            <br>
            <button id="capture-btn">üì∏ Capture</button>
            <br>
            <canvas id="snapshot" width="300" height="225" style="border-radius: 10px; border: 2px solid #ccc;"></canvas>
        </div>
    </div>
</div>
    <footer>
        <p>&copy; 2025 Food Sensei. Powered by Gemini + Crew AI.</p>
    </footer>

<script>

    
        let percent = 0;
        const text = document.getElementById("loader-text");
      
        const interval = setInterval(() => {
          percent++;
          text.textContent = percent + "%";
          if (percent >= 100) {
            clearInterval(interval);
          }
        }, 30); 
      
      
    window.addEventListener("load", () => {
        const loader = document.getElementById("loader-wrapper");
        setTimeout(() => {
            loader.style.display = "none";
        }, 3000); 
    });


    const task1Btn = document.querySelector('a[href="/task1"]');
    const video = document.getElementById('camera');
    const canvas = document.getElementById('snapshot');
    const captureButton = document.getElementById('capture-btn');
    const cameraSection = document.getElementById('camera-section');
    
    
    let message = document.createElement('p');
    message.id = "message";
    message.style.marginTop = "15px";
    cameraSection.appendChild(message);
    
    function startWebcam() {
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
            })
            .catch(err => {
                console.log('Error accessing webcam: ' + err);
                message.innerHTML = "‚ö†Ô∏è Error accessing webcam.";
            });
    }
    
    function captureImage() {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const imageData = canvas.toDataURL('image/png');
        sendImageToServer(imageData);
    }
    
    function sendImageToServer(imageData) {
        message.className = "loading";
        message.textContent = "üß† Analyzing...";
    
        fetch('/capture', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ image_data: imageData })
        })
        .then(res => res.json())
        .then(data => {
            message.className = "";
            message.textContent = data.comment || "‚úÖ Image sent!";
        })
        .catch(err => {
            message.className = "";
            message.textContent = "‚ùå Error sending image.";
        });
    }
    
    
    const task1Link = document.querySelector('a[href="/task1"]');
    task1Link.addEventListener('click', (e) => {
        e.preventDefault(); 
        cameraSection.style.display = 'block'; 
        startWebcam(); 
    });

    captureButton.onclick = captureImage;
        
</script>
    
</body>

</html>
